(()=>{const e=[{type:"text",value:"[SPOILER BLOCKED]"},{type:"text",value:"[CONTENT HIDDEN]"},{type:"text",value:"[NO SPOILERS HERE!]"},{type:"emoji",value:"🙈 🙉 🙊"},{type:"emoji",value:"⚠️ SPOILER ALERT ⚠️"},{type:"emoji",value:"🛑 STOP! SPOILERS AHEAD 🛑"}];function t(){const t=Math.floor(Math.random()*e.length);return e[t]}function o(e){if(console.log("Blocking spoilers for keywords:",e),!e||0===e.length)return;const o=e.filter((e=>e.length>=3)).map((e=>e.toLowerCase()));0!==o.length&&document.querySelectorAll("p, span, div, h1, h2, h3, h4, h5, h6, a, li").forEach((e=>{if(e.classList.contains("spoiler-processed")||"SCRIPT"===e.tagName||"STYLE"===e.tagName||"NOSCRIPT"===e.tagName||"none"===getComputedStyle(e).display)return;const n=e.textContent;if(!n||""===n.trim())return;const r=n.toLowerCase();let s=!1;for(const e of o)if(r.includes(e)){s=!0;break}if(s){let n=e.innerHTML;e.classList.add("spoiler-processed");for(const e of o){const o=new RegExp("\\b("+e+"[s|es]?)\\b","gi");n=n.replace(o,(function(e){const o=t();return`<span class="spoiler-text" \n                       style="background-color: ${"text"===o.type?"#222":"#f8d7da"}; \n                              color: ${"text"===o.type?"#fff":"#721c24"}; \n                              padding: 2px 4px; \n                              border-radius: 3px; \n                              cursor: pointer;"\n                       title="Click to reveal spoiler"\n                       data-original="${e}"\n                       onclick="this.outerHTML=this.getAttribute('data-original')">\n                    ${o.value}\n                  </span>`}))}e.innerHTML=n}}))}function n(){console.log("Initializing Spoiler Blocker - Word Level"),chrome.runtime.sendMessage({action:"getKeywords"},(e=>{console.log("Received keywords response:",e),e&&e.keywords?o(e.keywords):console.log("No keywords found in response")})),new MutationObserver((e=>{for(const t of e)if(t.addedNodes.length){chrome.runtime.sendMessage({action:"getKeywords"},(e=>{e&&e.keywords&&o(e.keywords)}));break}})).observe(document.body,{childList:!0,subtree:!0})}document.addEventListener("click",(function(e){if(e.target.classList.contains("spoiler-text")){const t=e.target.getAttribute("data-original");t&&(e.target.outerHTML=t)}})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})();